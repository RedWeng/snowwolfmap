<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é›ªç‹¼ç”·å­©ï½œMISSION â€” è¨˜æ†¶ä¹‹æ ¸</title>

<!-- ===================== è³‡æºæ”¾ç½®å°ç…§è¡¨ï¼ˆè«‹æŒ‰æ­¤è·¯å¾‘æ”¾ï¼‰ =====================
video/mc_60s.mp4                 â† 30â€“60 ç§’ã€Œè¨˜æ†¶ä¹‹æ ¸ã€å‰ªè¼¯å½±ç‰‡ï¼ˆä¸å¾ªç’°ï¼Œæœ€å¾Œåœæ ¼ï¼‰
img/mc_poster.jpg                â† å½±ç‰‡è¼‰å…¥å‰çš„å°é¢åœ–
img/avatars/heather.png          â† æµ·ç‘Ÿ 512x512 é€æ˜
img/avatars/dean.png             â† è¿ªæ© 512x512 é€æ˜
img/avatars/isaac.png            â† è‰¾è–©å…‹ 512x512 é€æ˜
img/avatars/yasonina.png         â† é›…ç´¢å¦®å¨œ 512x512 é€æ˜ï¼ˆè‹¥éœ€è¦ï¼‰
audio/bgm_core_intro.mp3         â† å–®ä¸€é¦– BGMï¼ˆè¦èƒ½å¾ªç’°ï¼‰ï¼Œç•«é¢åœä¹Ÿç¹¼çºŒæ’­
audio/explosion_fx.mp3           â† çˆ†è£‚éŸ³æ•ˆï¼ˆ1~2 ç§’ï¼‰
========================================================================= -->

<style>
  :root{
    --c-primary:#8bd3ff; --c-accent:#4fd5ff;
    --c-text:#e7f1ff; --c-sub:#b9d2ea; --blur:8px;
  }
  html,body{margin:0;height:100%;overflow:hidden;background:#000;
    font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}

  /* èƒŒæ™¯å½±ç‰‡èˆ‡æµ·å ± */
  #poster{position:absolute;inset:0;background:url("img/mc_poster.jpg") center/cover no-repeat;z-index:0;opacity:1;transition:opacity .8s ease;}
  #bgVideo{position:absolute;inset:0;z-index:0;width:100%;height:100%;
    object-fit:cover;filter:brightness(.86) contrast(1.08);opacity:0;transition:opacity .8s ease;}

  /* å‹•æ…‹å±¤ï¼šå…‰ç²’ / é›ª / çˆ†è£‚ç«ç„° / ç«æ˜Ÿ */
  canvas#particles, canvas#snow, canvas#embers{position:absolute;inset:0;z-index:1;pointer-events:none;}
  #fireLayer{position:absolute;inset:0;overflow:hidden;pointer-events:none;z-index:2;}

  /* ç« ç¯€æ¨™é¡Œ */
  .chapter{
    position:absolute;top:24px;left:50%;transform:translateX(-50%);
    color:var(--c-text);letter-spacing:.18em;font-weight:600;z-index:5;
    text-shadow:0 0 24px #0009, 0 0 32px #0009;
  }

  /* HUDã€èƒŒåŒ… */
  .hud{position:absolute;right:18px;top:18px;z-index:6;display:flex;gap:12px}
  .btn{
    background:linear-gradient(90deg,#1e6aff,#4fd5ff); color:#fff;border:none;border-radius:10px;
    padding:10px 16px; font-size:.96rem; letter-spacing:.06em; cursor:pointer;
    box-shadow:0 0 16px #4fb4ff66; transition:.25s ease;
  }
  .btn:hover{transform:translateY(-2px);box-shadow:0 0 24px #8bd3ffaa;}
  .btn.secondary{background:#0b1630cc;border:1px solid #8bd3ff55;box-shadow:none;color:#cfe9ff}
  .btn.ghost{background:transparent;border:1px solid #8bd3ff33;color:#b9d2ea}
  .inventory{
    position:absolute;left:18px;bottom:18px;z-index:6;display:flex;gap:8px;align-items:center;
    color:#cfe9ff;background:#0a1222b3;padding:10px 12px;border-radius:10px;border:1px solid #8bd3ff55;backdrop-filter:blur(6px)
  }

  /* é¸é …ï¼šé¡¯ç¤ºåœ¨å°è©±æ¡†ä¸Šæ–¹ï¼Œä¸è¢«é®ä½ */
  .choices{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:calc(40px + 180px);
    display:none; z-index:8; gap:12px; flex-direction:column; width:min(760px,92vw)
  }
  .choice{
    background:#0a1222cc; border:1px solid #8bd3ff55; border-radius:12px;
    padding:14px 16px; color:#d7eaff; cursor:pointer; transition:.2s; backdrop-filter:blur(6px)
  }
  .choice:hover{border-color:#9fe0ff;box-shadow:0 0 18px #3ec7ff55;transform:translateY(-2px)}
  @media (max-width: 900px){ .choices{ bottom:calc(40px + 220px); } }

  /* å°è©±å€ï¼ˆæ²¿ç”¨å‰ç‰ˆï¼‰ */
  .dialog{
    position:absolute;left:50%;bottom:40px;transform:translateX(-50%);
    width:min(980px,92vw);z-index:5;display:grid;grid-template-columns:96px 1fr;
    gap:18px;align-items:end;backdrop-filter:blur(var(--blur));
    background:linear-gradient(180deg,#0a1222aa,#03060c99);
    border:1px solid #6fbaf833;border-radius:16px;padding:16px 18px;
    box-shadow:0 0 36px #061427aa,inset 0 0 0 1px #8bd3ff22;
  }
  .avatar{width:96px;height:96px;border-radius:12px;background:#0a1222 url() center/contain no-repeat;border:1px solid #8bd3ff55;box-shadow:0 0 24px #2ec7ff33;}
  .bubble{color:var(--c-text);line-height:1.6;}
  .name{font-weight:800;letter-spacing:.12em;margin-bottom:6px;color:#cfe9ff}
  .content{color:var(--c-sub);font-size:1.05rem}
  .ctl{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}

  /* çˆ†è£‚é–ƒå…‰ */
  @keyframes flash { 0%, 100% { opacity: 0; } 10%, 40%, 70% { opacity: 1; } }
  .core-explosion::before{
    content:"";position:absolute;inset:0;z-index:9;pointer-events:none;
    background:radial-gradient(circle at center, rgba(255,200,120,.85), rgba(255,120,40,.0) 70%);
    animation:flash 1.1s ease-out forwards;
  }

  /* ç«ç„°ç²’å­å‹•ç•« */
  @keyframes fireRise { 0% { transform: scale(1) translateY(0); opacity:.9; } 100% { transform: scale(3.2) translateY(-120px); opacity:0; } }
  .fireParticle{
    position:absolute;width:6px;height:6px;border-radius:50%;
    background:radial-gradient(circle,#ffd27a,#ff6a2a 60%,transparent);
    opacity:.9;animation:fireRise 2s linear forwards; filter:blur(.2px);
  }
</style>
</head>
<body>

<!-- æµ·å ±èˆ‡å½±ç‰‡ -->
<div id="poster"></div>
<video id="bgVideo" autoplay muted playsinline>
  <source src="video/mc_60s.mp4" type="video/mp4">
</video>

<!-- å‹•æ…‹å±¤ -->
<canvas id="particles"></canvas>
<canvas id="snow"></canvas>
<canvas id="embers"></canvas>
<div id="fireLayer"></div>

<div class="chapter">MISSION â€” è¨˜æ†¶ä¹‹æ ¸ / Memory Core</div>

<!-- HUD -->
<div class="hud">
  <button class="btn secondary" id="btnBgm">BGMï¼šé–‹</button>
  <button class="btn ghost" id="btnSkip">è·³éå°è©±</button>
</div>

<!-- èƒŒåŒ… -->
<div class="inventory">
  ğŸ’ èƒŒåŒ…ï¼š<span id="invList">è¨˜æ†¶ä¹‹æ ¸</span>
  <button class="btn secondary" id="btnUse">ä½¿ç”¨é“å…·</button>
</div>

<!-- é¸é … -->
<div class="choices" id="choices"></div>

<!-- å°è©±å€ -->
<div class="dialog" id="dialog">
  <div class="avatar" id="avatar"></div>
  <div class="bubble">
    <div class="name" id="name">â€”</div>
    <div class="content" id="text">â€¦</div>
    <div class="ctl">
      <button class="btn" id="btnNext">ä¸‹ä¸€å¥ â–·</button>
      <button class="btn secondary" id="btnAuto">è‡ªå‹•æ’­æ”¾</button>
    </div>
  </div>
</div>

<script>
/* ============== å½±ç‰‡è¼‰å…¥èˆ‡åœæ ¼ï¼ˆä¸å¾ªç’°ï¼‰ ============== */
const video = document.getElementById('bgVideo');
const poster = document.getElementById('poster');
video.loop = false;
video.addEventListener('loadeddata', ()=>{ video.style.opacity = 1; poster.style.opacity = 0; });
video.addEventListener('ended', ()=> video.pause());             // åœåœ¨æœ€å¾Œç•«é¢
video.addEventListener('error', ()=>{ console.warn("Video load error"); poster.style.opacity = 1; });

/* ============== å–®ä¸€ BGMï¼šå¾ªç’°æ’­æ”¾ï¼Œèˆ‡å½±ç‰‡ç„¡é—œ ============== */
const bgm = new Audio('audio/bgm_core_intro.mp3');
bgm.loop = true;                   // ä¸€ç›´æ’­
bgm.volume = 0.75;                 // å¯ä¾å–œå¥½èª¿æ•´
const btnBgm = document.getElementById('btnBgm');

function startBgm(){ bgm.play().catch(()=>{}); }
document.addEventListener('pointerdown', startBgm, { once:true }); // é¦–æ¬¡äº’å‹•æ‰å•Ÿæ’­ï¼ˆç€è¦½å™¨ç­–ç•¥ï¼‰

btnBgm.onclick = ()=>{
  if(bgm.paused){ bgm.play(); btnBgm.textContent='BGMï¼šé–‹'; }
  else { bgm.pause(); btnBgm.textContent='BGMï¼šé—œ'; }
};

/* ============== å…‰ç²’ / é£„é›ª / ç«æ˜Ÿ ============== */
const cp = document.getElementById('particles'), pctx = cp.getContext('2d');
const cs = document.getElementById('snow'),      sctx = cs.getContext('2d');
const ce = document.getElementById('embers'),    ectx = ce.getContext('2d');
let W,H; let snowOn = true;
function resize(){ W=cp.width=cs.width=ce.width=innerWidth; H=cp.height=cs.height=ce.height=innerHeight; }
addEventListener('resize', resize); resize();

const particles = Array.from({length:120},()=>({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*2+0.6, s:Math.random()*0.4+0.2, a:Math.random()*Math.PI*2 }));
let flakes = Array.from({length:180},()=>({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*2+0.8, s:Math.random()*0.7+0.3, w:Math.random()*0.7+0.2 }));
let sparks = [];

(function loop(){
  // å…‰ç²’
  pctx.clearRect(0,0,W,H);
  pctx.fillStyle='rgba(160,220,255,.7)';
  particles.forEach(pt=>{
    pt.a+=0.002; pt.y+=pt.s; pt.x+=Math.sin(pt.a)*0.2;
    if(pt.y>H){ pt.y=-5; pt.x=Math.random()*W; }
    pctx.beginPath(); pctx.arc(pt.x,pt.y,pt.r,0,Math.PI*2); pctx.fill();
  });

  // é›ª
  sctx.clearRect(0,0,W,H);
  if(snowOn){
    sctx.fillStyle='rgba(255,255,255,.92)';
    flakes.forEach(f=>{
      f.y+=f.s; f.x+=Math.sin((f.y+f.x)*0.003)*f.w;
      if(f.y>H+6){ f.y=-6; f.x=Math.random()*W; }
      sctx.beginPath(); sctx.arc(f.x,f.y,f.r,0,Math.PI*2); sctx.fill();
    });
  }

  // ç«æ˜Ÿ
  ectx.clearRect(0,0,W,H);
  ectx.fillStyle='rgba(255,190,90,.95)';
  sparks.forEach(sp=>{
    sp.x += sp.vx; sp.y += sp.vy; sp.vy -= 0.02; sp.life -= 0.02;
    ectx.globalAlpha = Math.max(0, sp.life);
    ectx.beginPath(); ectx.arc(sp.x, sp.y, sp.r, 0, Math.PI*2); ectx.fill();
  });
  sparks = sparks.filter(sp=>sp.life>0);

  requestAnimationFrame(loop);
})();

/* ============== çˆ†è£‚ï¼š28s è§¸ç™¼ï¼ˆé–ƒå…‰ï¼‹ç«ç„°ç²’å­ï¼‹çˆ†éŸ³ï¼‹åœé›ªï¼‰ ============== */
setTimeout(()=>{
  document.body.classList.add('core-explosion');
  startFireParticles();
  snowOn = false;
  spawnEmbersBurst();
  const fx = new Audio('audio/explosion_fx.mp3'); fx.volume = 0.95; fx.play().catch(()=>{});
  // è£œå¹¾è¼ªç«ç„°ç¶­æŒç‡ƒç‡’æ„Ÿ
  let repeat = 0;
  const timer = setInterval(()=>{ startFireParticles(); spawnEmbersBurst(); if(++repeat>3) clearInterval(timer); }, 2000);
}, 28000);

function startFireParticles(){
  const layer = document.getElementById('fireLayer');
  for(let i=0;i<200;i++){
    const f = document.createElement('div');
    f.className='fireParticle';
    f.style.left = (Math.random()*innerWidth)+'px';
    f.style.bottom='0px';
    f.style.animationDuration = (1.5+Math.random()*1.6)+'s';
    layer.appendChild(f);
    setTimeout(()=>f.remove(), 3200);
  }
}
function spawnEmbersBurst(){
  for(let i=0;i<180;i++){
    sparks.push({
      x: innerWidth/2 + (Math.random()-0.5)*innerWidth*0.6,
      y: innerHeight*0.7 + (Math.random()-0.5)*80,
      vx: (Math.random()-0.5)*2.2,
      vy: Math.random()*2.8,
      r: Math.random()*2+0.6,
      life: 1.0
    });
  }
}

/* ============== å°è©±ç³»çµ±ï¼ˆæ²¿ç”¨ï¼‰ ============== */
const $name = document.getElementById('name');
const $text = document.getElementById('text');
const $avatar = document.getElementById('avatar');
const $next = document.getElementById('btnNext');
const $auto = document.getElementById('btnAuto');
const $skip = document.getElementById('btnSkip');
const $choices = document.getElementById('choices');
let autoTimer=null;

// èƒŒåŒ…ï¼ˆæ­¤é å›ºå®šé¡¯ç¤ºå·²æœ‰ã€Œè¨˜æ†¶ä¹‹æ ¸ã€ï¼‰
document.getElementById('btnUse').onclick = ()=>{ alert('è¨˜æ†¶ä¹‹æ ¸æ­£åœ¨è§£æä¸­â€¦â€¦æš«æ™‚ç„¡æ³•ä½¿ç”¨ã€‚'); };

const script = [
  { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œé€™è£¡çš„èƒ½é‡â€¦â€¦è·Ÿæˆ‘è¨˜æ†¶è£¡çš„è²éŸ³ä¸€æ¨£ã€‚ã€' },
  { n:'è¿ªæ©',   a:'img/avatars/dean.png',   t:'ã€Œåˆ¥äº‚ç¢°ã€‚ä»»ä½•ä¸€é»æ³¢å‹•ï¼Œéƒ½å¯èƒ½è§¸ç™¼é˜²è­·æ©Ÿåˆ¶ã€‚ã€' },
  { n:'æµ·ç‘Ÿ',   a:'img/avatars/heather.png',t:'ã€Œçœ‹é‚£é¡†æ ¸å¿ƒï¼åƒåœ¨å‘¼å¸â€¦â€¦ã€' },
  { n:'ç³»çµ±',   a:'', t:'ç›®æ¨™ï¼šé è¿‘è¨˜æ†¶ä¹‹æ ¸ï¼Œå•Ÿå‹•è§£æã€‚' },
  { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œå¦‚æœå®ƒèƒ½å‘Šè¨´æˆ‘çˆ¶è¦ªçš„ç·šç´¢â€¦â€¦å°±ç®—åªæ˜¯ä¸€é»é»ä¹Ÿå¥½ã€‚ã€' },
  { n:'ç³»çµ±',   a:'', t:'è§£æä¸­â€¦â€¦èƒ½é‡è‡¨ç•Œä¸Šå‡ã€‚è«‹å¾Œé€€ã€‚' },
  { n:'è¿ªæ©',   a:'img/avatars/dean.png',   t:'ã€Œé€€å¾Œï¼æˆ‘è¨˜å¾—è³‡æ–™å¯«è‘— 30 ç§’æœƒæœ‰ç¬¬äºŒéšæ®µåæ‡‰ï¼ã€' },
  { n:'æµ·ç‘Ÿ',   a:'img/avatars/heather.png',t:'ã€Œè‰¾è–©å…‹ï¼æŠ“ç·Šæˆ‘ï¼ã€' },
  { n:'ç³»çµ±',   a:'', t:'â€”â€”è‡¨ç•Œé»æŠµé”ã€‚è­¦å‘Šï¼šæ ¸å¿ƒå¤–æ®¼å³å°‡ç ´è£‚ã€‚' },
  { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œä¸ï¼å†çµ¦æˆ‘ä¸€é»æ™‚é–“ï¼ã€' },
  { n:'ç³»çµ±',   a:'', t:'çˆ†è£‚ç™¼ç”Ÿã€‚å•Ÿå‹•ç«ç„°æŠ‘åˆ¶åºåˆ—ã€‚è«‹é¸æ“‡å¾ŒçºŒè¡Œå‹•ã€‚', choice:[
      { label:'å°å°æ ¸å¿ƒï¼ˆç©©å®šå®¤ï¼‰', goto:'seal' },
      { label:'æ’¤é›¢ä¸¦æ•‘æ´ï¼ˆè¥¿å´é€šé“ï¼‰', goto:'evac' }
  ] }
];

const branches = {
  seal: [ { n:'ç³»çµ±', a:'', t:'ç›®æ¨™æ›´æ–°ï¼šæ–¼ 90 ç§’å…§å®Œæˆå°å°å„€å¼ã€‚', end:'mission_core_stabilize.html' } ],
  evac: [ { n:'ç³»çµ±', a:'', t:'ç›®æ¨™æ›´æ–°ï¼šè­·é€å…©åå—å›°è€…æ’¤é›¢ã€‚', end:'mission_evac_wing.html' } ]
};

let idx=0, active = script;

function render(line){
  if(!line) return;
  $name.textContent = line.n || ' ';
  $text.textContent = line.t || ' ';
  $avatar.style.backgroundImage = line.a ? `url(${line.a})` : 'none';

  if(line.choice){ showChoices(line.choice); } else { $choices.style.display='none'; }

  if(line.end){
    $next.textContent = 'å‰å¾€ä»»å‹™ â–·';
    $next.onclick = ()=>fadeTo(line.end);
  }else{
    $next.textContent = 'ä¸‹ä¸€å¥ â–·';
    $next.onclick = next;
  }
}
function next(){ idx++; if(idx>=active.length){ idx=active.length-1; return; } render(active[idx]); }
function showChoices(list){
  $choices.innerHTML = '';
  list.forEach(c=>{
    const div=document.createElement('div'); div.className='choice'; div.textContent=c.label;
    div.onclick = ()=>{ active = branches[c.goto] || active; idx = -1; $choices.style.display='none'; next(); };
    $choices.appendChild(div);
  });
  $choices.style.display='flex';
}

// è‡ªå‹•æ’­æ”¾
document.getElementById('btnAuto').onclick = function(){
  if(autoTimer){ clearInterval(autoTimer); autoTimer=null; this.textContent='è‡ªå‹•æ’­æ”¾'; return; }
  this.textContent='è‡ªå‹•ä¸­â€¦';
  autoTimer = setInterval(()=>{ if($choices.style.display==='flex') return; next(); }, 2600);
};

// è·³é
document.getElementById('btnSkip').onclick = ()=>{ idx=active.length-1; render(active[idx]); };

// è½‰å ´
function fadeTo(url){ document.body.style.transition='800ms ease'; document.body.style.opacity='0'; setTimeout(()=>location.href=url, 820); }

// åˆå§‹åŒ–
render(active[0]);
</script>
</body>
</html>
