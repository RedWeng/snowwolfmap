<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è˜­è–©çˆ¾å°å­¸ RPG v4.0</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.105.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/panolens@0.12.0/build/panolens.min.js"></script>

<style>
html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:"Noto Sans TC","PingFang TC",sans-serif;color:#e7eefb;}
#panoMount{position:fixed;inset:0;z-index:0;}
#ui{position:fixed;inset:0;z-index:10;pointer-events:none;}
button{pointer-events:auto;cursor:pointer;}
.topbar{position:absolute;top:12px;left:18px;right:18px;display:flex;gap:12px;z-index:20;}
.chip{background:#0f1726;color:#e7eefb;border:1px solid #223553;border-radius:999px;padding:8px 12px;font-size:13px;}
.chip:hover{background:#223553;}
.hud{position:absolute;top:58px;left:18px;display:flex;gap:18px;z-index:20;}
.bars{display:flex;gap:18px;}
.bar{width:180px;}
.bar label{font-size:12px;}
.meter{height:6px;background:#112;color:#9ad6ff;border-radius:8px;overflow:hidden;}
.meter span{display:block;height:100%;background:linear-gradient(90deg,#4aa3ff,#9ad6ff);width:25%;}
#hotspots{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:flex;gap:12px;z-index:15;flex-wrap:wrap;justify-content:center;}
.hotbtn{background:rgba(10,18,35,.8);color:#dff2ff;border:1px solid #27426e;padding:10px 14px;border-radius:14px;}
.hotbtn:hover{background:#355c9a;}
.dialog{position:fixed;left:18px;right:18px;bottom:88px;background:rgba(10,20,35,.9);border-radius:22px;padding:16px 22px;display:flex;align-items:flex-end;gap:16px;z-index:30;}
.avatar img{width:88px;height:88px;border-radius:16px;}
.dtext{flex:1;}
.who{font-weight:bold;font-size:18px;}
.line{font-size:17px;margin-top:6px;}
.btn{background:#173055;color:#fff;border:none;border-radius:12px;padding:10px 14px;}
.btn:hover{background:#295a9c;}
#questPanel{position:fixed;top:100px;right:20px;background:rgba(10,18,30,.8);border:1px solid #20314c;border-radius:14px;padding:12px 16px;z-index:25;}
#questList{list-style:none;padding:0;margin:0;}
#questList li{margin:4px 0;}
.shortcut{position:fixed;left:18px;bottom:18px;display:flex;gap:10px;z-index:40;}
.shortcut .chip{background:#0f2747cc;border-color:#2e507e;}
.toast{position:fixed;right:18px;bottom:18px;background:#0c1a30;color:#dff2ff;padding:10px 14px;border-radius:10px;display:none;z-index:999;}
#popup{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:200;}
#popupContent{background:#122;padding:20px;border-radius:14px;text-align:center;min-width:320px;}
</style>
</head>
<body>

<div id="panoMount"></div>

<div id="ui">

  <div class="topbar">
    <button id="btnHome" class="chip">ğŸ  è‰¾è–©å…‹çš„å®¶</button>
    <button id="btnWardrobe" class="chip">ğŸ§¥ è¡£æ«ƒ</button>
    <button id="btnItems" class="chip">ğŸ’ é“å…·</button>
    <div style="flex:1;"></div>
    <button id="exploreBtn" class="chip">ğŸ§­ æ¢ç´¢æ¨¡å¼</button>
  </div>

  <div class="hud">
    <div class="bars">
      <div class="bar"><label>å‹‡æ°£</label><div class="meter"><span id="mC"></span></div></div>
      <div class="bar"><label>åŒç†</label><div class="meter"><span id="mE"></span></div></div>
      <div class="bar"><label>çœŸå¯¦</label><div class="meter"><span id="mT"></span></div></div>
    </div>
  </div>

  <div id="hotspots">
    <button class="hotbtn" data-pan="gate">æ ¡é–€å£</button>
    <button class="hotbtn" data-pan="music">éŸ³æ¨‚æ•™å®¤</button>
    <button class="hotbtn" data-pan="art">ç¾è¡“æ•™å®¤</button>
    <button class="hotbtn" data-pan="library">åœ–æ›¸é¤¨</button>
    <button class="hotbtn" data-pan="playground">æ“å ´</button>
    <button class="hotbtn" data-pan="principal">æ ¡é•·å®¤</button>
  </div>

  <div class="dialog">
    <div class="avatar"><img src="img/avatars/heather.png" alt=""></div>
    <div class="dtext">
      <div id="who" class="who">æµ·ç‘Ÿ</div>
      <div id="line" class="line">ã€Œå›åˆ°è˜­è–©çˆ¾å°å­¸â€¦â€¦ç©ºæ°£éƒ½è®Šå¾—æº«æš–äº†ã€‚ã€</div>
    </div>
    <button id="next" class="btn">ä¸‹ä¸€å¥ â–¶</button>
  </div>

  <div id="questPanel">
    <h3>ä»»å‹™æ¸…å–®</h3>
    <ul id="questList">
      <li>ğŸ¨ ç¾è¡“ä»»å‹™</li>
      <li>ğŸµ éŸ³æ¨‚ä»»å‹™</li>
      <li>ğŸ“– é–±è®€ä»»å‹™</li>
      <li>âš™ï¸ é«”å‹•ä»»å‹™</li>
      <li>ğŸ‘‘ æ ¡é•·ä»»å‹™</li>
    </ul>
  </div>

  <div class="shortcut">
    <button class="chip" onclick="showToast('ğŸ« é€²å…¥å®¿èˆç•«é¢ï¼ˆä¹‹å¾Œé–‹æ–°é ï¼‰')">ğŸ« å®¿èˆ</button>
    <button class="chip" onclick="showToast('ğŸ“œ æŸ¥çœ‹å¸ƒå‘Šæ¬„')">ğŸ“œ å¸ƒå‘Šæ¬„</button>
    <button class="chip" onclick="showToast('ğŸ›ï¸ æˆå°±æ®¿å ‚å°šæœªé–‹æ”¾')">ğŸ›ï¸ æˆå°±æ®¿å ‚</button>
  </div>

  <div id="toast" class="toast"></div>

  <!-- è¡£æ«ƒèˆ‡é“å…·è¦–çª— -->
  <div id="popup">
    <div id="popupContent">
      <h3 id="popupTitle">æ¨™é¡Œ</h3>
      <p id="popupBody">å…§å®¹</p>
      <button id="closePopup" class="btn">é—œé–‰</button>
    </div>
  </div>
</div>

<script>
/* === Panorama === */
let viewer,currentPano;
const panoMount=document.getElementById("panoMount");
const PANO={
  gate:"img/360/school_gate_360.jpg",
  music:"img/360/school_music_360.jpg",
  art:"img/360/school_art_360.jpg",
  library:"img/360/school_library_360.jpg",
  playground:"img/360/school_playground_360.jpg",
  principal:"img/360/school_office_360.jpg",
  home:"img/360/school_dorm_360.jpg" // â† æ–°å¢è‰¾è–©å…‹çš„å®¶
};
function ensureViewer(){
  if(!viewer){
    viewer=new PANOLENS.Viewer({container:panoMount,controlBar:false,autoHideInfospot:true,cameraFov:75});
    viewer.container.style.pointerEvents='none';
  }
  return viewer;
}
function loadPano(name){
  const v=ensureViewer();
  const url=PANO[name];
  if(currentPano){try{v.remove(currentPano);}catch{} currentPano.dispose&&currentPano.dispose();}
  currentPano=new PANOLENS.ImagePanorama(url);
  v.add(currentPano);v.setPanorama(currentPano);
}
document.querySelectorAll(".hotbtn").forEach(b=>b.onclick=()=>loadPano(b.dataset.pan));
loadPano("gate");

/* === å°è©± === */
const dialogue=[
  {n:"æµ·ç‘Ÿ",t:"ã€Œå›åˆ°è˜­è–©çˆ¾å°å­¸â€¦â€¦ç©ºæ°£éƒ½è®Šå¾—æº«æš–äº†ã€‚ã€"},
  {n:"è‰¾è–©å…‹",t:"ã€Œé€™è£¡çœŸçš„å¥½ä¹…æ²’ä¾†äº†ï¼Œæˆ‘å¥½æ‡·å¿µã€‚ã€"},
  {n:"æµ·ç‘Ÿ",t:"ã€Œæˆ‘å€‘å»çœ‹çœ‹æ–°çš„éŸ³æ¨‚æ•™å®¤å§ï¼ã€"},
];
let idx=0;
document.getElementById("next").onclick=()=>{
  idx++;
  if(idx>=dialogue.length){idx=0;}
  document.getElementById("who").textContent=dialogue[idx].n;
  document.getElementById("line").textContent=dialogue[idx].t;
};

/* === ä¸Šæ–¹åŠŸèƒ½éµ === */
document.getElementById("btnHome").onclick=()=>{loadPano("home");showToast("ğŸ  é€²å…¥è‰¾è–©å…‹çš„å®¶");};
document.getElementById("btnItems").onclick=()=>{openPopup("é“å…·æ¸…å–®","ğŸ”¹ é›ªç‹¼çç <br>ğŸ”¹ èŠ’è‰<br>ğŸ”¹ è—è“æœä¹¾");};
document.getElementById("btnWardrobe").onclick=()=>{openPopup("è¡£æ«ƒ","é¸æ“‡æœè£ï¼š<br>â„ï¸ å†¬å­£å¤–å¥—<br>ğŸŒ¸ æ˜¥æ—¥æ ¡æœ<br>ğŸŒ² æ£®æ—é¢¨æ–—ç¯·");};

/* === æ¢ç´¢æ¨¡å¼ === */
let exploring=false;
document.getElementById("exploreBtn").onclick=()=>{
  exploring=!exploring;
  showToast(exploring?"ğŸ§­ æ¢ç´¢æ¨¡å¼é–‹å•Ÿï¼ˆæš«æ™‚å±•ç¤ºï¼‰":"ğŸ“˜ è¿”å›å°è©±æ¨¡å¼");
};

/* === Popup === */
const popup=document.getElementById("popup");
const popupTitle=document.getElementById("popupTitle");
const popupBody=document.getElementById("popupBody");
document.getElementById("closePopup").onclick=()=>popup.style.display="none";
function openPopup(title,body){
  popupTitle.innerHTML=title;
  popupBody.innerHTML=body;
  popup.style.display="flex";
}

/* === Toast === */
function showToast(t){
  const n=document.getElementById("toast");
  n.textContent=t;n.style.display='block';
  setTimeout(()=>n.style.display='none',1500);
}
</script>
</body>
</html>
