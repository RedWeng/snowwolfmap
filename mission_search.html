<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é›ªç‹¼ç”·å­©ï½œMISSION â€” å°‹æ‰¾å¤±è¹¤å­©å­</title>

<!-- ===================== è³‡æºæ”¾ç½®å°ç…§è¡¨ =====================
video/search_corridor.mp4        â† 30â€“60 ç§’æœå°‹å ´æ™¯å½±ç‰‡ï¼ˆä¸å¾ªç’°ï¼›æœ€å¾Œåœæ ¼ï¼‰
img/search_poster.jpg            â† å½±ç‰‡è¼‰å…¥å‰å°é¢
img/avatars/heather.png          â† æµ·ç‘Ÿ 512x512 é€æ˜
img/avatars/dean.png             â† è¿ªæ© 512x512 é€æ˜
img/avatars/isaac.png            â† è‰¾è–©å…‹ 512x512 é€æ˜
img/avatars/yasonina.png         â† é›…ç´¢å¦®å¨œï¼ˆå¯é¸ï¼‰
audio/bgm_search_tense.mp3       â† ç·Šå¼µæ¢ç´¢ BGMï¼ˆå–®ä¸€é¦–ï¼Œå¾ªç’°ï¼‰
============================================================ -->

<style>
  :root{
    --c-text:#e7f1ff; --c-sub:#b9d2ea;
    --blur:8px; --ui-w:max(680px,42vw);
  }
  html,body{margin:0;height:100%;overflow:hidden;background:#000;
    font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}

  /* å½±ç‰‡èˆ‡æµ·å ± */
  #poster{position:absolute;inset:0;background:url("img/search_poster.jpg") center/cover no-repeat;
    z-index:0;opacity:1;transition:opacity .8s ease;}
  #bgVideo{position:absolute;inset:0;z-index:0;width:100%;height:100%;
    object-fit:cover;filter:brightness(.86) contrast(1.08);opacity:0;transition:opacity .8s ease;}
  /* å‹•æ…‹å±¤ */
  canvas#particles, canvas#snow{position:absolute;inset:0;z-index:1;pointer-events:none;}

  /* ç« ç¯€æ¨™é¡Œ */
  .chapter{position:absolute;top:24px;left:50%;transform:translateX(-50%);
    color:var(--c-text);letter-spacing:.18em;font-weight:600;z-index:5;
    text-shadow:0 0 24px #0009, 0 0 32px #0009;}

  /* HUD & èƒŒåŒ… */
  .hud{position:absolute;right:18px;top:18px;z-index:6;display:flex;gap:12px}
  .btn{background:linear-gradient(90deg,#1e6aff,#4fd5ff);color:#fff;border:none;border-radius:10px;
    padding:10px 16px;font-size:.96rem;letter-spacing:.06em;cursor:pointer;
    box-shadow:0 0 16px #4fb4ff66;transition:.25s ease;}
  .btn:hover{transform:translateY(-2px);box-shadow:0 0 24px #8bd3ffaa;}
  .btn.secondary{background:#0b1630cc;border:1px solid #8bd3ff55;box-shadow:none;color:#cfe9ff}
  .btn.ghost{background:transparent;border:1px solid #8bd3ff33;color:#b9d2ea}
  .inventory{position:absolute;left:18px;bottom:18px;z-index:6;display:flex;gap:8px;align-items:center;
    color:#cfe9ff;background:#0a1222b3;padding:10px 12px;border-radius:10px;border:1px solid #8bd3ff55;backdrop-filter:blur(6px)}

  /* é¸é …ï¼ˆä¸Šç§»é¿å…è¢«å°è©±é®ä½ï¼‰ */
  .choices{position:absolute;left:50%;bottom:calc(40px + 220px);transform:translateX(-50%);
    display:none;z-index:5;gap:12px;flex-direction:column;width:min(760px,92vw)}
  .choice{background:#0a1222cc;border:1px solid #8bd3ff55;border-radius:12px;padding:14px 16px;
    color:#d7eaff;cursor:pointer;transition:.2s;backdrop-filter:blur(6px)}
  .choice:hover{border-color:#9fe0ff;box-shadow:0 0 18px #3ec7ff55;transform:translateY(-2px)}

  /* å°è©±å€ï¼ˆæ²¿ç”¨ï¼‰ */
  .dialog{position:absolute;left:50%;bottom:40px;transform:translateX(-50%);
    width:min(980px,92vw);z-index:5;display:grid;grid-template-columns:96px 1fr;
    gap:18px;align-items:end;backdrop-filter:blur(var(--blur));
    background:linear-gradient(180deg,#0a1222aa,#03060c99);
    border:1px solid #6fbaf833;border-radius:16px;padding:16px 18px;
    box-shadow:0 0 36px #061427aa,inset 0 0 0 1px #8bd3ff22;}
  .avatar{width:96px;height:96px;border-radius:12px;background:#0a1222 url() center/contain no-repeat;
    border:1px solid #8bd3ff55;box-shadow:0 0 24px #2ec7ff33;}
  .bubble{color:var(--c-text);line-height:1.6;}
  .name{font-weight:800;letter-spacing:.12em;margin-bottom:6px;color:#cfe9ff}
  .content{color:var(--c-sub);font-size:1.05rem}
  .ctl{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>

<!-- æµ·å ±èˆ‡å½±ç‰‡ -->
<div id="poster"></div>
<video id="bgVideo" autoplay muted playsinline>
  <source src="video/search_corridor.mp4" type="video/mp4">
</video>

<!-- å‹•æ…‹å±¤ -->
<canvas id="particles"></canvas>
<canvas id="snow"></canvas>

<div class="chapter">MISSION â€” å°‹æ‰¾å¤±è¹¤å­©å­ / Search Missing Child</div>

<!-- HUD -->
<div class="hud">
  <button class="btn secondary" id="btnBgm">BGMï¼šé–‹</button>
  <button class="btn ghost" id="btnSkip">è·³éå°è©±</button>
</div>

<!-- èƒŒåŒ… -->
<div class="inventory">
  ğŸ’ èƒŒåŒ…ï¼š<span id="invList">æ‰‹é›»ç­’ï¼ˆå¾®å…‰ï¼‰ã€ç¹ƒå¸¶</span>
  <button class="btn secondary" id="btnUse">ä½¿ç”¨é“å…·</button>
</div>

<!-- é¸é … -->
<div class="choices" id="choices"></div>

<!-- å°è©±å€ -->
<div class="dialog" id="dialog">
  <div class="avatar" id="avatar"></div>
  <div class="bubble">
    <div class="name" id="name">â€”</div>
    <div class="content" id="text">â€¦</div>
    <div class="ctl">
      <button class="btn" id="btnNext">ä¸‹ä¸€å¥ â–·</button>
      <button class="btn secondary" id="btnAuto">è‡ªå‹•æ’­æ”¾</button>
    </div>
  </div>
</div>

<script>
/* ============== å½±ç‰‡è¼‰å…¥èˆ‡åœæ ¼ï¼ˆä¸å¾ªç’°ï¼‰ ============== */
const video = document.getElementById('bgVideo');
const poster = document.getElementById('poster');
video.loop = false;
video.addEventListener('loadeddata', ()=>{ video.style.opacity=1; poster.style.opacity=0; });
video.addEventListener('ended', ()=> video.pause());
video.addEventListener('error', ()=>{ console.warn('Video load error'); poster.style.opacity=1; });

/* ============== å–®ä¸€å¾ªç’° BGM ============== */
const bgm = new Audio('audio/bgm_search_tense.mp3');
bgm.loop = true; bgm.volume = 0.55;
const btnBgm = document.getElementById('btnBgm');
function tryPlay(){ bgm.play().catch(()=>{}); }
document.addEventListener('pointerdown', tryPlay, { once:true });
btnBgm.onclick = ()=>{ if(bgm.paused){ bgm.play(); btnBgm.textContent='BGMï¼šé–‹'; } else { bgm.pause(); btnBgm.textContent='BGMï¼šé—œ'; } };

/* ============== å…‰ç²’ + é£„é›ªï¼ˆæ·¡ï¼‰ ============== */
const p = document.getElementById('particles'), pctx = p.getContext('2d');
const s = document.getElementById('snow'), sctx = s.getContext('2d');
let W,H; const particles=[], flakes=[];
function resize(){ W=p.width=s.width=innerWidth; H=p.height=s.height=innerHeight; }
addEventListener('resize',resize); resize();
for(let i=0;i<110;i++){ particles.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*2+0.6,s:Math.random()*0.35+0.18,a:Math.random()*Math.PI*2}) }
for(let i=0;i<140;i++){ flakes.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.6+0.6,s:Math.random()*0.55+0.25,w:Math.random()*0.6+0.2}) }
(function loop(){
  pctx.clearRect(0,0,W,H); pctx.fillStyle='rgba(160,220,255,.65)';
  particles.forEach(pt=>{ pt.a+=0.002; pt.y+=pt.s; pt.x+=Math.sin(pt.a)*0.2; if(pt.y>H){pt.y=-5;pt.x=Math.random()*W;}
    pctx.beginPath(); pctx.arc(pt.x,pt.y,pt.r,0,Math.PI*2); pctx.fill(); });
  sctx.clearRect(0,0,W,H); sctx.fillStyle='rgba(255,255,255,.85)';
  flakes.forEach(f=>{ f.y+=f.s; f.x+=Math.sin((f.y+f.x)*0.003)*f.w; if(f.y>H+6){f.y=-6;f.x=Math.random()*W;}
    sctx.beginPath(); sctx.arc(f.x,f.y,f.r,0,Math.PI*2); sctx.fill(); });
  requestAnimationFrame(loop);
})();

/* ============== å°è©±ç³»çµ±ï¼ˆæ²¿ç”¨ï¼‰ ============== */
const $name = document.getElementById('name');
const $text = document.getElementById('text');
const $avatar = document.getElementById('avatar');
const $next = document.getElementById('btnNext');
const $choices = document.getElementById('choices');
let autoTimer=null;

const inv = ['æ‰‹é›»ç­’ï¼ˆå¾®å…‰ï¼‰','ç¹ƒå¸¶']; // å±•ç¤º
document.getElementById('btnUse').onclick = ()=>{
  alert('ä½ åˆ‡æ›äº†æ‰‹é›»ç­’å¾®å…‰ï¼ˆ+å¯è¦‹åº¦ï¼Œ-å®¹æ˜“è¢«ç™¼ç¾ï¼‰ã€‚');
};

// ä¸»ç·šå°è© + åˆ†æ”¯å…¥å£
const script = [
  { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œå‘¼â€”â€”åˆ¥å‡ºè²ã€‚æˆ‘çœ‹åˆ°å‰é¢æœ‰å¾ˆå°çš„å½±å­ã€‚ã€' },
  { n:'è¿ªæ©', a:'img/avatars/dean.png',    t:'ã€Œè…³å°å¾€åŒ—å´å´å»Šã€‚çŸ³å¡Šé¬†å‹•ï¼Œå°å¿ƒåˆ¥è¸©ã€‚ã€' },
  { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œç­‰ç­‰ï¼Œé‚£ä¸æ˜¯å­©å­ï¼Œæ˜¯â€¦â€¦èª˜é¤Œï¼Ÿã€' },
  { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œå½±å­åœ¨ç™¼æŠ–ã€‚ä¹Ÿè¨±çœŸçš„æœ‰äººã€‚ã€' },
  { n:'è¿ªæ©', a:'img/avatars/dean.png',    t:'ã€Œæ±ºå®šå§ï¼šç«‹åˆ»ä¸Šå‰ï¼Œæˆ–ç¹å´å»ŠåŒ…æŠ„ã€‚ã€', choice:[
      { label:'ç›´æ¥ä¸Šå‰å®‰æ’«ï¼ˆé¢¨éšªé«˜ï¼‰', goto:'front' },
      { label:'ç¹è¡Œå´å»ŠåŒ…æŠ„ï¼ˆå®‰å…¨ï¼‰', goto:'flank' }
    ] }
];

// åˆ†æ”¯
const branches = {
  front: [
    { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œå—¨ï¼Œæˆ‘å€‘æ˜¯ä¾†å¸¶ä½ å›å®¶çš„â€”â€”ã€' },
    { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œå°å¿ƒï¼å²©å£æœ‰ç•°å‹•ï¼ã€' },
    { n:'ç³»çµ±', a:'', t:'ä½ ä¿è­·äº†å½±å­ã€‚ä½†é€šé“å´©è½ï¼Œå¿…é ˆæ”¹èµ°ä¸‹å±¤ç®¡é“ã€‚', end:'mission_core.html' }
  ],
  flank: [
    { n:'è¿ªæ©', a:'img/avatars/dean.png', t:'ã€Œä¸‰ã€äºŒã€ä¸€â€”â€”æˆ‘å¾å³å´ç‰½åˆ¶ã€‚ã€' },
    { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€ŒæŠ“åˆ°äº†ï¼çœŸçš„æ˜¯å­©å­â€¦â€¦ä½†è¢«æ–½äº†å¹»å½±ã€‚ã€' },
    { n:'ç³»çµ±', a:'', t:'è§£é™¤å¹»å½±ï¼Œéœ€è¦å›åˆ°ã€Œè¨˜æ†¶ä¹‹æ ¸ã€å–å¾—é‘°åŒ™ç¢ç‰‡ã€‚', end:'mission_core.html' }
  ]
};

let idx=0, active=script;
function render(line){
  if(!line) return;
  $name.textContent = line.n || ' ';
  $text.textContent = line.t || ' ';
  $avatar.style.backgroundImage = line.a ? `url(${line.a})` : 'none';

  if(line.choice){ showChoices(line.choice); } else { $choices.style.display='none'; }

  const btnNext = document.getElementById('btnNext');
  if(line.end){
    btnNext.textContent='è¿”å›ï¼šè¨˜æ†¶ä¹‹æ ¸ â–·';
    btnNext.onclick=()=>fadeTo(line.end);
  }else{
    btnNext.textContent='ä¸‹ä¸€å¥ â–·';
    btnNext.onclick=next;
  }
}
function next(){ idx++; if(idx>=active.length){ idx=active.length-1; return; } render(active[idx]); }
function showChoices(list){
  $choices.innerHTML='';
  list.forEach(c=>{
    const div=document.createElement('div'); div.className='choice'; div.textContent=c.label;
    div.onclick=()=>{ active = branches[c.goto] || active; idx=-1; $choices.style.display='none'; next(); };
    $choices.appendChild(div);
  });
  $choices.style.display='flex';
}

// è‡ªå‹•æ’­æ”¾ & è·³é
document.getElementById('btnAuto').onclick = function(){
  if(autoTimer){ clearInterval(autoTimer); autoTimer=null; this.textContent='è‡ªå‹•æ’­æ”¾'; return; }
  this.textContent='è‡ªå‹•ä¸­â€¦';
  autoTimer=setInterval(()=>{ if($choices.style.display==='flex') return; next(); }, 2600);
};
document.getElementById('btnSkip').onclick = ()=>{ idx=active.length-1; render(active[idx]); };

// è½‰å ´
function fadeTo(url){ document.body.style.transition='800ms ease'; document.body.style.opacity='0'; setTimeout(()=>location.href=url, 820); }

// åˆå§‹åŒ–
render(active[0]);
</script>
</body>
</html>
