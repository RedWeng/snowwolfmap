<!doctype html> 
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é›ªç‹¼ç”·å­©ï½œé›ªä¹‹è–æ®¿</title>
<style>
  :root{ --c-primary:#8bd3ff; --c-accent:#4fd5ff; --c-text:#e7f1ff; --c-sub:#b9d2ea; --blur:8px; }
  html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  #bgVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.82) contrast(1.08);opacity:0;transition:opacity .8s ease;z-index:0;}
  #poster{position:absolute;inset:0;background:url("img/temple_poster.jpg") center/cover no-repeat;z-index:0;opacity:1;transition:opacity .8s ease;}
  canvas#particles, canvas#snow{position:absolute;inset:0;z-index:1;pointer-events:none;}
  .chapter{position:absolute;top:24px;left:50%;transform:translateX(-50%);color:var(--c-text);letter-spacing:.18em;font-weight:600;z-index:5;text-shadow:0 0 24px #0009, 0 0 32px #0009;}
  .dialog{
    position:absolute;left:50%;bottom:40px;transform:translateX(-50%);
    width:min(980px,92vw);z-index:5;display:grid;grid-template-columns:96px 1fr;gap:18px;align-items:end;
    backdrop-filter:blur(var(--blur));background:linear-gradient(180deg,#0a1222aa,#03060c99);
    border:1px solid #6fbaf833;border-radius:16px;padding:16px 18px;
    box-shadow:0 0 36px #061427aa,inset 0 0 0 1px #8bd3ff22;
  }
  .avatar{width:96px;height:96px;border-radius:12px;background:#0a1222 center/contain no-repeat;border:1px solid #8bd3ff55;box-shadow:0 0 24px #2ec7ff33;}
  .bubble{color:var(--c-text);line-height:1.6;}
  .name{font-weight:800;letter-spacing:.12em;margin-bottom:6px;color:#cfe9ff}
  .content{color:var(--c-sub);font-size:1.05rem}
  .ctl{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:linear-gradient(90deg,#1e6aff,#4fd5ff);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-size:.98rem;letter-spacing:.06em;cursor:pointer;box-shadow:0 0 16px #4fb4ff66;transition:.25s ease;}
  .btn:hover{transform:translateY(-2px);box-shadow:0 0 24px #8bd3ffaa;}
  .btn.secondary{background:#0b1630cc;border:1px solid #8bd3ff55;box-shadow:none;color:#cfe9ff}
  .btn.ghost{background:transparent;border:1px solid #8bd3ff33;color:#b9d2ea}

  /* é¸é …ï¼šä½ç½®äº¤çµ¦ JS å‹•æ…‹è¨ˆç®—ï¼Œé€™è£¡çµ¦é è¨­ä¿éšªå€¼ */
  .choices{
    position:absolute;left:50%;transform:translateX(-50%);bottom:220px;
    display:none;z-index:5;gap:12px;flex-direction:column;width:min(760px,92vw)
  }
  .choice{background:#0a1222cc;border:1px solid #8bd3ff55;border-radius:12px;padding:14px 16px;color:#d7eaff;cursor:pointer;transition:.2s;backdrop-filter:blur(6px)}
  .choice:hover{border-color:#9fe0ff;box-shadow:0 0 18px #3ec7ff55;transform:translateY(-2px)}

  .hud{position:absolute;right:18px;top:18px;z-index:6;display:flex;gap:12px;}
  .hud .btn{padding:8px 12px;font-size:.9rem}
  .inventory{position:absolute;left:18px;bottom:18px;z-index:6;display:flex;gap:8px;align-items:center;color:#cfe9ff;background:#0a1222b3;padding:10px 12px;border-radius:10px;border:1px solid #8bd3ff55;backdrop-filter:blur(6px)}
</style>
</head>
<body>

<div id="poster"></div>
<video id="bgVideo" autoplay muted loop playsinline>
  <source src="video/temple_loop.mp4" type="video/mp4">
</video>

<canvas id="particles"></canvas>
<canvas id="snow"></canvas>

<div class="chapter">CHAPTER I â€” é›ªä¹‹è–æ®¿ / The Snow Temple</div>

<div class="hud">
  <button class="btn secondary" id="btnBgm">BGMï¼šé–‹</button>
  <button class="btn ghost" id="btnSkip">è·³éå°è©±</button>
</div>

<div class="inventory">
  ğŸ’ èƒŒåŒ…ï¼š<span id="invList">ç©º</span>
  <button class="btn secondary" id="btnUse">ä½¿ç”¨é“å…·</button>
</div>

<div class="choices" id="choices"></div>

<div class="dialog" id="dialog">
  <div class="avatar" id="avatar"></div>
  <div class="bubble">
    <div class="name" id="name">â€”</div>
    <div class="content" id="text">â€¦</div>
    <div class="ctl">
      <button class="btn" id="btnNext">ä¸‹ä¸€å¥ â–·</button>
      <button class="btn secondary" id="btnAuto">è‡ªå‹•æ’­æ”¾</button>
    </div>
  </div>
</div>

<script>
/* ===== å…ˆæŠ“æ‰€æœ‰ DOMï¼ˆé¿å…å°šæœªåˆå§‹åŒ–å°±è¢«å‘¼å«ï¼‰ ===== */
const video = document.getElementById('bgVideo');
const poster = document.getElementById('poster');
const p = document.getElementById('particles'), pctx = p.getContext('2d');
const s = document.getElementById('snow'), sctx = s.getContext('2d');
const $name = document.getElementById('name');
const $text = document.getElementById('text');
const $avatar = document.getElementById('avatar');
const $next = document.getElementById('btnNext');
const $autoBtn = document.getElementById('btnAuto');
const $skip = document.getElementById('btnSkip');
const $choices = document.getElementById('choices');
const $dialog = document.getElementById('dialog');
const invList = document.getElementById('invList');
let autoTimer=null;

/* ===== å½±ç‰‡ / BGMï¼ˆåŸæ¨£ï¼‰ ===== */
video.addEventListener('loadeddata', ()=>{ video.style.opacity=1; poster.style.opacity=0; });
video.addEventListener('error', ()=>{ console.warn("Video load error"); poster.style.opacity=1; });

const bgm = new Audio('audio/bgm_temple_intro.mp3');
bgm.loop = true; bgm.volume = 0.45;
document.getElementById('btnBgm').onclick = () => {
  if(bgm.paused){ bgm.play(); event.currentTarget.textContent='BGMï¼šé–‹'; }
  else{ bgm.pause(); event.currentTarget.textContent='BGMï¼šé—œ'; }
};
document.addEventListener('pointerdown', ()=>bgm.play().catch(()=>{}), { once:true });

/* ===== å…‰ç²’ & é£„é›ª ===== */
let W,H; const particles=[], flakes=[];
function placeChoices(){
  // é˜²å‘†ï¼šå…ƒç´ é‚„æ²’å°±ç·’å°±å…ˆè·³å‡º
  if(!$dialog || !$choices) return;
  const h = $dialog.getBoundingClientRect().height || 160;
  $choices.style.bottom = (h + 32) + 'px';
}
function resize(){
  W=p.width=s.width=innerWidth; H=p.height=s.height=innerHeight;
  placeChoices();
}
addEventListener('resize',resize);

function initParticles(){
  particles.length=0; flakes.length=0;
  for(let i=0;i<120;i++) particles.push({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*2+0.6, s:Math.random()*0.4+0.2, a:Math.random()*Math.PI*2 });
  for(let i=0;i<180;i++) flakes.push({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*2+0.8, s:Math.random()*0.7+0.3, w:Math.random()*0.7+0.2 });
}
function animate(){
  pctx.clearRect(0,0,W,H);
  pctx.fillStyle='rgba(160,220,255,.7)';
  particles.forEach(pt=>{ pt.a+=0.002; pt.y+=pt.s; pt.x+=Math.sin(pt.a)*0.2; if(pt.y>H){ pt.y=-5; pt.x=Math.random()*W; } pctx.beginPath(); pctx.arc(pt.x,pt.y,pt.r,0,Math.PI*2); pctx.fill(); });
  sctx.clearRect(0,0,W,H);
  sctx.fillStyle='rgba(255,255,255,.92)';
  flakes.forEach(f=>{ f.y+=f.s; f.x+=Math.sin((f.y+f.x)*0.003)*f.w; if(f.y>H+6){ f.y=-6; f.x=Math.random()*W; } sctx.beginPath(); sctx.arc(f.x,f.y,f.r,0,Math.PI*2); sctx.fill(); });
  requestAnimationFrame(animate);
}

/* ===== å°è©±ç³»çµ± ===== */
const inv = [];
document.getElementById('btnUse').onclick = ()=>{ if(!inv.length){ alert('èƒŒåŒ…æ˜¯ç©ºçš„ã€‚'); return; } alert('ä½¿ç”¨ï¼š'+inv[0]+'ï¼ˆç¯„ä¾‹ï¼Œå¯æ“´å……ï¼‰'); };

const script = [
  { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œé€™è£¡â€¦â€¦å°±æ˜¯é›ªä¹‹è–æ®¿ï¼Ÿç©ºæ°£åƒæœƒç™¼å…‰ä¸€æ¨£ã€‚ã€' },
  { n:'è¿ªæ©', a:'img/avatars/dean.png',    t:'ã€Œå°å¿ƒè…³ä¸‹ï¼Œé€™ç¨®åœ°å½¢å¾ˆå®¹æ˜“æ»‘å€’ã€‚é‡Œç‰¹ï¼Œåˆ¥é›¢å¤ªé ï¼ã€' },
  { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png',  t:'ã€Œç­‰ç­‰â€¦â€¦ä½ å€‘æœ‰è½åˆ°å—ï¼Ÿåƒæ˜¯â€¦é˜è²åœ¨é›ªè£¡è¿´ç›ªã€‚ã€' },
  { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œä½ å€‘çµ‚æ–¼ä¾†äº†ã€‚å­©å­å€‘ï¼Œæ­¡è¿å›åˆ°ã€é›…ç´¢å®¶æ—çš„æ®¿å ‚ã€ã€‚ã€' },
  { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œå¦³æ˜¯â€¦â€¦è²äºçš„æ¯è¦ªï¼Ÿã€' },
  { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œæˆ‘åœ¨æ­¤å®ˆæœ›å¾ˆä¹…ï¼Œç‚ºç­‰ä½ å€‘å¸¶å›å¤±è½çš„å‹‡æ°£èˆ‡çœŸå¯¦ã€‚ã€' },
  { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œåœ¨ä½ å€‘é¢å‰æœ‰ä¸‰æ¢è·¯â€”â€”é¸æ“‡ï¼Œå³æ˜¯ä»£åƒ¹ã€‚ã€', choice:[
      { label:'é€²å…¥è–æ®¿å¯¶è—', goto:'treasure' },
      { label:'é›¢é–‹è–æ®¿', goto:'leave' },
      { label:'å°‹æ‰¾å¤±è¹¤å­©å­', goto:'search' }
    ]
  }
];

const branches = {
  treasure: [
    { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œå¯¶è—ä¸æ˜¯é‡‘éŠ€ï¼Œè€Œæ˜¯æœƒæ˜ ç…§å¿ƒæ„çš„ã€è¨˜æ†¶ä¹‹æ ¸ã€ã€‚ã€' },
    { n:'è‰¾è–©å…‹', a:'img/avatars/isaac.png', t:'ã€Œå¦‚æœèƒ½è¦‹åˆ°ä»–æœ€å¾Œä¸€æ¬¡â€¦â€¦æˆ‘æƒ³çŸ¥é“ä»–æ˜¯å¦é‚„æ´»è‘—ã€‚ã€' },
    { n:'ç³»çµ±', a:'', t:'å–å¾—é“å…·ï¼šè¨˜æ†¶ä¹‹æ ¸', act:()=>{ inv.push('è¨˜æ†¶ä¹‹æ ¸'); invList.textContent = inv.join('ã€'); } },
    { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œæº–å‚™å¥½äº†å°±è·Ÿæˆ‘ä¾†å§ã€‚ã€ï¼ˆå°‡å‰å¾€ï¼šè¨˜æ†¶ä¹‹æ ¸Â·å›æ”¶ä»»å‹™ï¼‰', end:'mission_core.html' }
  ],
  leave: [
    { n:'è¿ªæ©', a:'img/avatars/dean.png', t:'ã€Œç¾åœ¨æ’¤é›¢ä¸¦ä¸æ˜¯å¤±æ•—ï¼Œæ˜¯ç‚ºäº†æ›´å¥½çš„å›ä¾†ã€‚ã€' },
    { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œé“è·¯è‡ªæœƒç­‰å¾…ä½ å€‘ã€‚å¸¶è‘—æ¸…é†’é›¢é–‹ï¼Œä¹Ÿæ˜¯å‹‡æ°£ã€‚ã€', end:'map_world.html' }
  ],
  search: [
    { n:'æµ·ç‘Ÿ', a:'img/avatars/heather.png', t:'ã€Œæˆ‘è½è¦‹å°å°çš„è…³å°è²â€¦â€¦åœ¨æŸ±å»Šå¾Œé¢ï¼ã€' },
    { n:'é›…ç´¢å¦®å¨œ', a:'img/avatars/yasonina.png', t:'ã€Œè·Ÿè‘—éŠ€å…‰èµ°ï¼Œåˆ¥å›é ­ã€‚ã€' },
    { n:'ç³»çµ±', a:'', t:'ç›®æ¨™æ›´æ–°ï¼šæœå°‹å¤±è¹¤å­©å­ï¼ˆå€åŸŸï¼šåŒ—å´å´å»Šï¼‰', end:'mission_search.html' }
  ]
};

let idx=0, active=script;

function render(line){
  if(!line) return;
  $name.textContent = line.n || ' ';
  $text.textContent = line.t || ' ';
  $avatar.style.backgroundImage = line.a ? `url(${line.a})` : 'none';

  // æ–‡å­—æ›´æ–°å¾Œé‡ç®—é¸é …ä½ç½®
  requestAnimationFrame(placeChoices);

  if(line.choice){ showChoices(line.choice); } else { $choices.style.display='none'; }

  if(typeof line.act === 'function'){ line.act(); }

  if(line.end){
    $next.textContent='å‰å¾€ä»»å‹™ â–·';
    $next.onclick=()=>fadeTo(line.end);
  }else{
    $next.textContent='ä¸‹ä¸€å¥ â–·';
    $next.onclick=next;
  }
}

function next(){ idx++; if(idx>=active.length){ idx=active.length-1; return; } render(active[idx]); }

function showChoices(list){
  $choices.innerHTML='';
  list.forEach(c=>{
    const div=document.createElement('div');
    div.className='choice'; div.textContent=c.label;
    div.onclick=()=>{
      active = branches[c.goto] || active;
      idx = -1;
      $choices.style.display='none';
      next();
    };
    $choices.appendChild(div);
  });
  $choices.style.display='flex';
  placeChoices();
}

/* è‡ªå‹•æ’­æ”¾ / è·³é / è½‰å ´ */
$autoBtn.onclick=()=>{
  if(autoTimer){ clearInterval(autoTimer); autoTimer=null; $autoBtn.textContent='è‡ªå‹•æ’­æ”¾'; return; }
  $autoBtn.textContent='è‡ªå‹•ä¸­â€¦';
  autoTimer=setInterval(()=>{
    if($choices.style.display==='flex') return;
    next();
    if(idx===active.length-1 && !active[idx].end){ clearInterval(autoTimer); $autoBtn.textContent='è‡ªå‹•æ’­æ”¾'; }
  },2600);
};
$skip.onclick=()=>{ idx=active.length-1; render(active[idx]); };
function fadeTo(url){ document.body.style.transition='800ms ease'; document.body.style.opacity='0'; setTimeout(()=>location.href=url,820); }

/* ===== åˆå§‹åŒ–ï¼šå…ˆå°ºå¯¸â†’ç²’å­â†’å‹•ç•«â†’æ¸²æŸ“å°è©± ===== */
resize();
initParticles();
animate();
render(active[0]);
placeChoices();
</script>
</body>
</html>
