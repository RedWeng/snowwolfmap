<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è˜­è–©çˆ¾å®¿èˆ Dormitory | Snowwolf HUB</title>
<link rel="preload" as="audio" href="audio/dorm_theme.mp3">
<link rel="preload" as="audio" href="sfx/click.wav">
<style>
:root{--ink:#e7eefb;--muted:#9bb2d4;--chip:#152238;--panel:#0f1726;--edge:#223553;--radius:18px;}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:#000;
  font-family:"PingFang TC","Noto Sans TC",sans-serif;color:var(--ink)}
.bg{position:fixed;inset:0;background:url("img/bg/dormitory.jpg") center/cover no-repeat;
  filter:brightness(.98) contrast(1.04)}
.shade{position:fixed;inset:0;pointer-events:none;background:radial-gradient(1200px 800px at 50% 20%,rgba(0,0,0,.08),rgba(0,0,0,.55) 70%)}
#snow,#mist{position:fixed;inset:0;pointer-events:none}
.topbar{position:fixed;left:18px;right:18px;top:12px;z-index:10;display:flex;gap:12px;align-items:center}
.chip{background:var(--chip);color:#cfe1ff;border:1px solid var(--edge);border-radius:999px;padding:8px 12px;font-size:13px;cursor:pointer}
.spacer{flex:1}
.hud{position:fixed;left:18px;right:18px;top:58px;z-index:9;display:flex;gap:24px;align-items:center}
.bar{width:210px}.bar label{display:block;font-size:12px;color:#b9c8e6;margin:0 0 4px 2px}
.meter{height:6px;background:#0d1830;border:1px solid #1e2c47;border-radius:999px;overflow:hidden}
.meter span{display:block;height:100%;background:linear-gradient(90deg,#4aa3ff,#9ad6ff)}
.panel{position:fixed;left:50%;top:60%;transform:translate(-50%,-50%);z-index:6;width:min(1100px,92vw);
  display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.card{background:linear-gradient(180deg,#0e182bde,#0a1220e6);border:1px solid #1b2b47;border-radius:16px;
  backdrop-filter:blur(8px);padding:16px}
.card h4{margin:0 0 8px;font-size:16px}
.card p{margin:6px 0 10px;color:#c3d6f7;font-size:13px;min-height:36px}
.btn{background:#173055;color:#e7f1ff;border:1px solid #27426e;border-radius:12px;padding:8px 12px;font-size:13px;cursor:pointer}
.btn[disabled]{opacity:.45;cursor:not-allowed}
.select{width:100%;background:#0c1c34;color:#cfe1ff;border:1px solid #25426e;border-radius:10px;padding:8px}
.dialog{position:fixed;left:18px;right:18px;bottom:18px;z-index:7;background:linear-gradient(180deg,#0d1524e6,#0a111ee6);
  border:1px solid #1a2a44;border-radius:22px;padding:18px 22px;display:grid;grid-template-columns:88px 1fr auto;gap:18px;align-items:end}
.avatar img{width:88px;height:88px;border-radius:16px;object-fit:cover;border:1px solid #273a5a}
#returnGame{position:fixed;right:28px;bottom:108px;z-index:8;background:#173055;border:1px solid #2a4b7a;border-radius:50%;
  width:68px;height:68px;display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 0 20px #9ad6ff80;cursor:pointer}
.toast{position:fixed;right:18px;bottom:18px;background:#0c1a30;border:1px solid #234168;border-radius:12px;padding:10px 14px;display:none;z-index:50}
@media(max-width:960px){.panel{grid-template-columns:1fr}}
</style>
</head>
<body>
<canvas id="snow"></canvas><canvas id="mist"></canvas>
<div class="bg"></div><div class="shade"></div>

<div class="topbar">
  <button class="chip" data-jump="school.html">ğŸ« å›å­¸æ ¡</button>
  <button class="chip" data-jump="wardrobe.html">ğŸ§¥ è¡£æ«ƒ</button>
  <button class="chip" data-jump="bag.html">ğŸ’ é“å…·</button>
  <div class="spacer"></div>
  <div class="chip">ğŸ’° é‡‘å¹£ <b id="coins">0</b></div>
  <button id="bgmBtn" class="chip">BGMï¼šé–‹</button>
</div>

<div class="hud">
  <div class="bar"><label>å‹‡æ°£ Courage</label><div class="meter"><span id="mC" style="width:0%"></span></div></div>
  <div class="bar"><label>åŒç† Empathy</label><div class="meter"><span id="mE" style="width:0%"></span></div></div>
  <div class="bar"><label>çœŸå¯¦ Truth</label><div class="meter"><span id="mT" style="width:0%"></span></div></div>
</div>

<!-- ä¸‰å¤§åŠŸèƒ½ï¼šä¼‘æ¯ / å¿ƒæƒ…æ—¥èªŒ / å±•ç¤ºé“å…· -->
<div class="panel">
  <div class="card">
    <h4>ğŸ›ï¸ ä¼‘æ¯ä¸€ä¸‹</h4>
    <p>å¥½å¥½ç¡ä¸€è¦ºã€‚å¿ƒæ›´è¸å¯¦ã€æ€ç·’æ›´æ¸…æ™°ã€‚ï¼ˆå‹‡æ°£ +1ã€çœŸå¯¦ +1ï¼Œå†·å»ï¼šæ¯æ—¥ä¸€æ¬¡ï¼‰</p>
    <button id="btnRest" class="btn">ä¼‘æ¯ä¸¦èª¿æ•´ç‹€æ…‹</button>
  </div>
  <div class="card">
    <h4>ğŸ““ å¿ƒæƒ…æ—¥èªŒ</h4>
    <p>å¯«ä¸‹ä»Šå¤©çš„ä¸€å¥è©±ï¼Œé¸æ“‡ä½ æƒ³ä¿®ç…‰çš„é¢å‘ã€‚ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼‰</p>
    <select id="journalPick" class="select">
      <option value="C">æˆ‘é¡˜æ„å†å¾€å‰ä¸€æ­¥ï¼ˆå‹‡æ°£ +1ï¼‰</option>
      <option value="E">æˆ‘æƒ³ç†è§£åˆ¥äººçš„å¿ƒï¼ˆåŒç† +1ï¼‰</option>
      <option value="T">æˆ‘æœƒå°è‡ªå·±èª å¯¦ï¼ˆçœŸå¯¦ +1ï¼‰</option>
    </select>
    <button id="btnJournal" class="btn" style="margin-top:8px">å¯«å…¥æ—¥èªŒä¸¦æˆé•·</button>
  </div>
  <div class="card">
    <h4>ğŸ–¼ï¸ å±•ç¤ºå°æ”¶è—</h4>
    <p>æŠŠèƒŒåŒ…ä¸­çš„ä¸€ä»¶é“å…·æ“ºåˆ°æ›¸æ¶ä¸Šï¼Œå¯ç²å¾—ä¸€æ¬¡æ€§çš„æš–å¿ƒåŠ æˆï¼ˆåŒç† +1ï¼‰ã€‚</p>
    <select id="displayItem" class="select"></select>
    <button id="btnDisplay" class="btn" style="margin-top:8px">æ“ºä¸Šæ›¸æ¶</button>
  </div>
</div>

<!-- å°è©± -->
<div class="dialog">
  <div class="avatar"><img id="ava" src="img/avatars/heather.png" alt=""></div>
  <div>
    <div id="who" style="font-weight:700;font-size:18px">æµ·ç‘Ÿ</div>
    <div id="line" class="line">ã€Œæˆ¿é–“æœ‰é»å†·ï¼Œä½†å¾ˆå®‰å¿ƒã€‚ä»Šæ™šè¦ä¸è¦å¯«é»æ±è¥¿ï¼Ÿã€</div>
  </div>
  <button id="next" class="btn">ä¸‹ä¸€å¥ â–¶</button>
</div>

<div id="returnGame" title="å›åˆ°å†’éšª">ğŸ”ï¸</div>
<div id="toast" class="toast"></div>

<audio id="bgm" src="audio/dorm_theme.mp3" loop></audio>
<audio id="sfx" src="sfx/click.wav" preload="auto"></audio>

<script>
const $=q=>document.querySelector(q);const SFX=$('#sfx');
const toast=t=>{const n=$('#toast');n.textContent=t;n.style.display='block';setTimeout(()=>n.style.display='none',1200);}
function sfx(){try{SFX.currentTime=0;SFX.play();}catch{}}

const state={
  coins:Number(localStorage.getItem('coins')||140),
  C:+localStorage.getItem('stat_C')||24,
  E:+localStorage.getItem('stat_E')||18,
  T:+localStorage.getItem('stat_T')||12,
  bag:JSON.parse(localStorage.getItem('bag')||'[]')
};
const mm={C:$('#mC'),E:$('#mE'),T:$('#mT')};
function syncHUD(){
  $('#coins').textContent=state.coins;
  mm.C.style.width=Math.min(state.C,100)+'%';
  mm.E.style.width=Math.min(state.E,100)+'%';
  mm.T.style.width=Math.min(state.T,100)+'%';
  localStorage.setItem('coins',state.coins);
  localStorage.setItem('stat_C',state.C);
  localStorage.setItem('stat_E',state.E);
  localStorage.setItem('stat_T',state.T);
  localStorage.setItem('bag',JSON.stringify(state.bag));
}
syncHUD();

// å°è©±
const scripts=[
  {n:'æµ·ç‘Ÿ',a:'img/avatars/heather.png',t:'ã€Œæˆ¿é–“æœ‰é»å†·ï¼Œä½†å¾ˆå®‰å¿ƒã€‚ä»Šæ™šè¦ä¸è¦å¯«é»æ±è¥¿ï¼Ÿã€'},
  {n:'è¿ªæ©',a:'img/avatars/dean.png',t:'ã€Œç¡å‰åšå€‹ä¼¸å±•ï¼Œèº«é«”æœƒè¬è¬ä½ ã€‚ã€'},
  {n:'èˆç›£',a:'img/avatars/warden.png',t:'ã€Œå¥½äº†!æ—©é»ä¼‘æ¯å§,æˆ‘è¦é—œç‡ˆäº†ã€‚ã€'},
  {n:'è‰¾è–©å…‹',a:'img/avatars/isaac.png',t:'ã€ŒæŠŠç²å¾—çš„é“å…·æ“ºä¸Šæ›¸æ¶å§ï¼Œçœ‹è‘—å®ƒæœƒæƒ³åˆ°ä»Šå¤©çš„åŠªåŠ›ã€‚ã€'},
  {n:'ç³»çµ±',a:'img/avatars/system.png',t:'æç¤ºï¼šä¼‘æ¯èˆ‡æ—¥èªŒæ¯å¤©å„èƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚'}
];
let si=0;function say(o){$('#who').textContent=o.n;$('#line').textContent=o.t;$('#ava').src=o.a;}
$('#next').onclick=()=>{sfx();say(scripts[si++%scripts.length])};say(scripts[0]);

// å†·å»èˆ‡å±•ç¤ºè¨˜éŒ„
const DAY = new Date().toISOString().slice(0,10);
const COOLDOWN_REST_KEY='dorm_rest_day';
const COOLDOWN_JOURNAL_KEY='dorm_journal_day';
const DISPLAYED_KEY='dorm_displayed_items';
let displayed=new Set(JSON.parse(localStorage.getItem(DISPLAYED_KEY)||'[]'));

function checkCooldown(key){return localStorage.getItem(key)===DAY}

// ä¼‘æ¯
$('#btnRest').onclick=()=>{sfx();
  if(checkCooldown(COOLDOWN_REST_KEY)) return toast('ä»Šå¤©å·²ç¶“å¥½å¥½ä¼‘æ¯éäº†ã€‚');
  state.C+=1; state.T+=1; syncHUD(); localStorage.setItem(COOLDOWN_REST_KEY,DAY);
  toast('ç²¾ç¥é£½æ»¿ï¼å‹‡æ°£+1ã€çœŸå¯¦+1');
};

// æ—¥èªŒ
$('#btnJournal').onclick=()=>{sfx();
  if(checkCooldown(COOLDOWN_JOURNAL_KEY)) return toast('ä»Šå¤©çš„æ—¥èªŒå·²å®Œæˆã€‚');
  const pick=$('#journalPick').value;
  if(pick==='C') state.C+=1; else if(pick==='E') state.E+=1; else state.T+=1;
  syncHUD(); localStorage.setItem(COOLDOWN_JOURNAL_KEY,DAY);
  toast('å¯«ä¸‹äº†ä»Šæ—¥çš„å¿ƒå¿µã€‚å±¬æ€§+1');
};

// å±•ç¤ºé“å…·
function renderBagOptions(){
  const sel=$('#displayItem'); sel.innerHTML='';
  const usable=state.bag.filter(x=>!displayed.has(x));
  if(!usable.length){sel.innerHTML='<option value="">ï¼ˆæ²’æœ‰å¯å±•ç¤ºçš„é“å…·ï¼‰</option>';return;}
  usable.forEach(i=>{const o=document.createElement('option');o.value=i;o.textContent=i;sel.appendChild(o);});
}
renderBagOptions();

$('#btnDisplay').onclick=()=>{sfx();
  const v=$('#displayItem').value;if(!v) return toast('æ²’æœ‰å¯å±•ç¤ºçš„é“å…·');
  if(displayed.has(v)) return toast('å·²å±•ç¤ºé');
  displayed.add(v); localStorage.setItem(DISPLAYED_KEY,JSON.stringify([...displayed]));
  state.E+=1; syncHUD(); renderBagOptions(); toast(`æŠŠã€Œ${v}ã€æ”¾ä¸Šæ›¸æ¶ã€‚ï¼ˆåŒç†+1ï¼‰`);
};

// å°è¦½
document.querySelectorAll('[data-jump]').forEach(b=>b.addEventListener('click',()=>{sfx();location.href=b.dataset.jump;}));
$('#returnGame').onclick=()=>{sfx();location.href='mission_snow_temple.html';};

// BGM
const bgm=$('#bgm'); function play(){try{bgm.volume=.8;bgm.play();}catch{}}
play(); $('#bgmBtn').onclick=()=>{sfx(); if(bgm.paused){play();$('#bgmBtn').textContent='BGMï¼šé–‹';}else{bgm.pause();$('#bgmBtn').textContent='BGMï¼šé—œ';}};

// é£„é›ª
(function snow(){const c=$('#snow'),x=c.getContext('2d');function rs(){c.width=innerWidth;c.height=innerHeight}addEventListener('resize',rs);rs();
const a=Array.from({length:140},()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*2+0.8,v:Math.random()*0.6+0.3}));
(function loop(){x.clearRect(0,0,c.width,c.height);x.fillStyle='rgba(230,245,255,.9)';
a.forEach(f=>{f.y+=f.v;f.x+=Math.sin(f.y*0.01)*0.2;if(f.y>c.height){f.y=-10;f.x=Math.random()*c.width}x.beginPath();x.arc(f.x,f.y,f.r,0,Math.PI*2);x.fill();});
requestAnimationFrame(loop);})();})();
// è–„éœ§
(function mist(){const c=$('#mist'),ctx=c.getContext('2d');function rs(){c.width=innerWidth;c.height=innerHeight}addEventListener('resize',rs);rs();let t=0;
(function loop(){t+=0.003;ctx.clearRect(0,0,c.width,c.height);for(let i=0;i<3;i++){const g=ctx.createRadialGradient((Math.sin(t+i)*0.3+0.5)*c.width,(Math.cos(t*0.8+i)*0.2+0.8)*c.height,0,(Math.sin(t+i)*0.3+0.5)*c.width,(Math.cos(t*0.8+i)*0.2+0.8)*c.height,Math.min(c.width,c.height)*.6);g.addColorStop(0,'rgba(120,170,220,0.06)');g.addColorStop(1,'rgba(120,170,220,0)');ctx.fillStyle=g;ctx.fillRect(0,0,c.width,c.height);}requestAnimationFrame(loop);})();})();
</script>
</body>
</html>
