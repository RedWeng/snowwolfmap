<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>雪狼男孩｜任務：營地之夜</title>
<style>
:root{--c-primary:#8bd3ff;--c-accent:#4fd5ff;--c-text:#e7f1ff;--c-sub:#b9d2ea;--blur:8px}
html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:"Noto Sans TC",system-ui}
#poster{position:absolute;inset:0;background:url("img/camp_poster.jpg") center/cover no-repeat;z-index:0;opacity:1;transition:opacity .8s}
#bgVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.84) contrast(1.06);opacity:0;transition:opacity .8s;z-index:0}
canvas#particles,canvas#snow{position:absolute;inset:0;z-index:1;pointer-events:none}
.chapter{position:absolute;top:24px;left:50%;transform:translateX(-50%);color:var(--c-text);letter-spacing:.18em;font-weight:600;z-index:5;text-shadow:0 0 24px #0009,0 0 32px #0009}
.dialog{position:absolute;left:50%;bottom:40px;transform:translateX(-50%);width:min(980px,92vw);z-index:5;display:grid;grid-template-columns:96px 1fr;gap:18px;align-items:end;backdrop-filter:blur(var(--blur));background:linear-gradient(180deg,#0a1222aa,#03060c99);border:1px solid #6fbaf833;border-radius:16px;padding:16px 18px;box-shadow:0 0 36px #061427aa,inset 0 0 0 1px #8bd3ff22}
.avatar{width:96px;height:96px;border-radius:12px;background:#0a1222 center/contain no-repeat;border:1px solid #8bd3ff55;box-shadow:0 0 24px #2ec7ff33}
.bubble{color:var(--c-text);line-height:1.6}.name{font-weight:800;letter-spacing:.12em;margin-bottom:6px;color:#cfe9ff}.content{color:var(--c-sub);font-size:1.05rem}
.ctl{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
.btn{background:linear-gradient(90deg,#1e6aff,#4fd5ff);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-size:.98rem;letter-spacing:.06em;cursor:pointer;box-shadow:0 0 16px #4fb4ff66;transition:.25s}
.btn:hover{transform:translateY(-2px);box-shadow:0 0 24px #8bd3ffaa}
.btn.secondary{background:#0b1630cc;border:1px solid #8bd3ff55;box-shadow:none;color:#cfe9ff}
.choices{position:absolute;left:50%;transform:translateX(-50%);bottom:calc(40px + 180px);display:none;z-index:8;gap:12px;flex-direction:column;width:min(760px,92vw)}
.choice{background:#0a1222cc;border:1px solid #8bd3ff55;border-radius:12px;padding:14px 16px;color:#d7eaff;cursor:pointer;transition:.2s;backdrop-filter:blur(6px)}
.choice:hover{border-color:#9fe0ff;box-shadow:0 0 18px #3ec7ff55;transform:translateY(-2px)}
@media(max-width:900px){.choices{bottom:calc(40px + 220px)}}
</style>
</head>
<body>
<div id="poster"></div>
<video id="bgVideo" autoplay muted playsinline><source src="video/camp_evening.mp4" type="video/mp4"></video>
<canvas id="particles"></canvas><canvas id="snow"></canvas>
<div class="chapter">MISSION — 營地之夜 / Camp at Dusk</div>

<div class="dialog" id="dialog">
  <div class="avatar" id="avatar"></div>
  <div class="bubble">
    <div class="name" id="name">—</div>
    <div class="content" id="text">…</div>
    <div class="ctl">
      <button class="btn" id="btnNext">下一句 ▷</button>
      <button class="btn secondary" id="btnAuto">自動播放</button>
    </div>
  </div>
</div>
<div class="choices" id="choices"></div>

<script>
// 影片
const v=document.getElementById('bgVideo'), poster=document.getElementById('poster');
v.addEventListener('loadeddata',()=>{v.style.opacity=1;poster.style.opacity=0;}); v.loop=false; v.addEventListener('ended',()=>v.pause());
v.addEventListener('error',()=>poster.style.opacity=1);

// BGM
const bgm=new Audio('audio/bgm_camp_evening.mp3'); bgm.loop=true; bgm.volume=.5;
document.addEventListener('pointerdown',()=>bgm.play().catch(()=>{}),{once:true});

// 粒子/雪
const cp=document.getElementById('particles'), pctx=cp.getContext('2d');
const cs=document.getElementById('snow'), sctx=cs.getContext('2d');
let W,H; function resize(){W=cp.width=cs.width=innerWidth;H=cp.height=cs.height=innerHeight} addEventListener('resize',resize); resize();
const parts=Array.from({length:90},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.6+.6,s:Math.random()*.26+.18,a:Math.random()*Math.PI*2}));
const flakes=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*2+.5,s:Math.random()*.46+.22,w:Math.random()*.8+.2}));
(function loop(){
  pctx.clearRect(0,0,W,H); pctx.fillStyle='rgba(150,210,255,.55)';
  parts.forEach(p=>{p.a+=.002;p.y+=p.s;p.x+=Math.sin(p.a)*.18;if(p.y>H){p.y=-5;p.x=Math.random()*W;}pctx.beginPath();pctx.arc(p.x,p.y,p.r,0,Math.PI*2);pctx.fill();});
  sctx.clearRect(0,0,W,H); sctx.fillStyle='rgba(255,255,255,.88)';
  flakes.forEach(f=>{f.y+=f.s;f.x+=Math.sin((f.y+f.x)*.003)*f.w;if(f.y>H+6){f.y=-6;f.x=Math.random()*W;}sctx.beginPath();sctx.arc(f.x,f.y,f.r,0,Math.PI*2);sctx.fill();});
  requestAnimationFrame(loop);
})();

// 劇本
const $n=name,$t=text,$a=avatar,$next=btnNext,$auto=btnAuto,$choices=document.getElementById('choices'); let timer=null;
const script=[
  {n:'迪恩',a:'img/avatars/dean.png',t:'「火堆維持小火，別引來不必要的東西。」'},
  {n:'海瑟',a:'img/avatars/heather.png',t:'「我煮了熱湯……雖然是旅人套餐。」'},
  {n:'艾薩克',a:'img/avatars/isaac.png',t:'「森林像在聽我們說話，一直在回應。」'},
  {n:'艾琳',a:'img/avatars/erinn.png',t:'「明天月相轉換，夜裡的路才會打開。」'},
  {n:'艾琳',a:'img/avatars/erinn.png',t:'「今晚有兩個選擇，你們決定——」',choice:[
    {label:'在營地訓練（提升生存技能）',goto:'train'},
    {label:'夜間偵查（低風險探路）',goto:'scout'}
  ]}
];
const branches={
  train:[{n:'系統',a:'',t:'完成：營地訓練 LV.1（體力+1/繩索+1）',end:'mission_camp_train.html'}],
  scout:[{n:'系統',a:'',t:'完成：夜間偵查（取得地形資訊）',end:'mission_camp_scout.html'}]
};
let idx=0,active=script;
function render(l){ if(!l)return; $n.textContent=l.n||' '; $t.textContent=l.t||' '; $a.style.backgroundImage=l.a?`url(${l.a})`:'none';
  if(l.choice){ showChoices(l.choice); } else { $choices.style.display='none'; }
  if(l.end){ $next.textContent='前往任務 ▷'; $next.onclick=()=>go(l.end); } else { $next.textContent='下一句 ▷'; $next.onclick=next; }
}
function next(){ idx++; if(idx>=active.length){idx=active.length-1;return;} render(active[idx]); }
function showChoices(list){ $choices.innerHTML=''; list.forEach(c=>{const d=document.createElement('div');d.className='choice';d.textContent=c.label;d.onclick=()=>{active=branches[c.goto]||active;idx=-1;$choices.style.display='none';next();};$choices.appendChild(d);}); $choices.style.display='flex';}
const $autoBtn=document.getElementById('btnAuto'); $autoBtn.onclick=()=>{ if(timer){clearInterval(timer);timer=null;$autoBtn.textContent='自動播放';return;} $autoBtn.textContent='自動中…'; timer=setInterval(()=>{ if($choices.style.display==='flex')return; next(); if(idx===active.length-1&&!active[idx].end){clearInterval(timer);$autoBtn.textContent='自動播放';}},2600); };
function go(u){ document.body.style.transition='800ms ease'; document.body.style.opacity='0'; setTimeout(()=>location.href=u,820); }
render(active[0]);
</script>
</body></html>
